# (Не)очевидные трюки отладки фронтенда
*фото c фронтендером, кидающим девасы / Firefox и Chrome лого / что-нибудь еще*

Так получается, что большую часть времени разработчик тратит на отладку кода.
Поэтому нужно уметь это делать, и делать это хорошо.  
Что бы вы могли сказать про отладку и фронтенд? Конечно же _console.log_, _debugger_ и еще десяток классных штук из DevTools. Теперь вы знаете о чем будет половина этого текста ツ  
А за остальным интригующе приглашаю под кат!

### Дисклеймер
Все будет в коротком виде – описание с применением. Многие трюки весьма просты, но это не является показателем их бесполезности.  
Подрoбности специально убраны под спойлер, чтобы туда смотрели только если этот трюк неизвестен. Надеюсь что доступное описание все же будет полезно.

Приведнные примеры были сделаны в [Chrome Canary](https://www.google.com/chrome/browser/canary.html) и [Firefox Developer Edition](https://www.mozilla.org/en-US/firefox/developer/), поэтому лучше установить эти версии браузеров. Так вы сможете уже сейчас пользоваться тем, что в стабильной версии появится только через 3 месяца.

#### Редактирование кода в браузере
Представим что мы столкнулись с проблемой на лайве и изменять скрипты на сервере мы не имеем возможности. В таком случае мы можем попробовать изменить код до выполнения (и даже во время выполнения) в Chrome.  
Для этого нужно поставить точку останова до интересующего нас кода, внести необходимые изменения, сохранить и продолжить выполнение.

Я сделал [демку](http://reepush.github.io/publications/obvious-frontend-debugging-tricks/demos/live-edit/live-edit.html). Попробуйте ее пройти не заглядывая под кат.

>  
Как пройти демо:

1. Находим скрипт _live-edit.js_ и ставим точку останова на строке 1
2. Перезагружаем страницу
3. Выполнение останавливается и мы можем изменить значение переменной `isItEasy` на `true`
4. После сохраняем (`Ctrl` + `S`)
5. Продолжаем выполнение

>  
Работает очень магически, ни один бразуер кроме Chrome так делать не умеет. А именно – при изменении весь код в текущем контексте выполняется заново. Это нужно учитывать, ведь в некоторых случаях функции могут изменять внешнее состояние
и лишние изменения будут нежелательными.  
Пример такого поведения можно посмотреть в [этом демо](http://reepush.github.io/publications/obvious-frontend-debugging-tricks/demos/live-edit/live-edit-scoping.html). Обратите внимание что после изменения кода в консоли появится _IIFE executed 2 time_.

К сожалению с этим способом нельзя сохранить наши изменения при перезагрузке.
Для чего-то более сложного лучше использовать прокси.

#### Подмена скриптов через прокси
Мы все так же на лайве, без доступов к скриптам. По сравнению с предыдущим примером нам нужно сделать более масштабные изменения, или может быть еще необходим препроцессинг нашего кода.  
Будем делать все изменения локально и подменять скрипты с помощью BrowserSync. В [примере](https://gist.github.com/reepush/5d9bb62112b4bf183926#file-readme-md) будет подключен наш скрипт и стили на главную страницу Яндекса.

>  
Клонируем пример, устанивливаем зависимости и запускаем:
```
git clone https://gist.github.com/5d9bb62112b4bf183926.git proxify-assets
npm install
gulp
```
Теперь заходим на [https://localhost:3000/](https://localhost:3000/) и видим всем знакомую страницу. Но только у нас еще подключено два файла: _custom.css_ и _custom.js_. Попробуйте их изменить – BrowserSync автоматически перезагрузит страницу при изменении скрипта, а изменения стилей применятся мгновенно без перезагрузки.  
В этом примере мы не заменяли внешние скрипты на локальные, но это очень просто сделать лишь изменив _rewriteRules_ в настройках BrowserSync.

#### Подмена страниц в WebView
Подключаемся к девайсу инспектором и изменяем window.location.href на нужный.
Нужно иметь в виду что отладка возможна только начиная с Android версии 4.4.
*почитать что там обновляется*

Полезно когда нужно сделать изменения, но при этом не хотелось бы пересобирать приложение для другого урла. Про изменения на продакшене я вообще не говорю.

> Подробнее
window.location.href = xxx, и мы видим любую интересующую нас страницу.
Референс на то Как сохранить страницу, как захостить страницу.

#### Отладка с помощью Valence
Valence является адаптером к различным браузерам / девайсам.
Таким образом можно использовать привычный инструмент всегда, либо сделать его привычным ;) А под Windows это единственный способ отлаживать девайсы c iOS.

#### Вылезаем из локальной сети
Мы хотим показать свою работу, но при этом не хотелось бы аплоадить ее куда-нибудь. Либо нам нужно вытащить свой дев-сервер наружу.
Для этого отлично подходит ngrok, либо SSH в случае если у вас есть VPS.

> Подробнее
Наша машинка находится в локальной сети (например локальная сеть на работе) и все те кто находится не на работе, не смогут иметь доступ к нашей машинке. Поэтому мы используем сервер-посредник, который общедоступен. Трафик идет через посредника, соединение установлено.

#### Букмарклет для повторяющихся действий
Заполнение формочек, регистрация аккаунта.
Пример с формочкой.

#### Воспроизводим как тестировщики
Букмарклет для получения всей необходимой информации.
* url
* cookies
* html
* stack traces
*
httponly cookies (нужен плагин)

#### Эмулятор Android девайсов
Genymotion прекрасен!

#### Сохранение страницы
Это все лишь обычный `cmd` + `S`. Но что можно сделать со страницей дальше?
*Chrome не сохраняет скрипты?*
Мы можем залить ее на хостинг, какой-нибудь Dropbox или Github Pages.
Либо выполнить `python -m SimpeHTTServer` и получить локальный сервер раздающий статику. Дальше можно пойти в _Вылезаем из локальной сети_, и вытащить свой локальный сервер наружу.

#### Mixed Type Content
Возникает когда есть http и https. Какой-то из них не загружается.
Это очень частая ошибка, про которую почему-то все забывают. Последний раз был случай, когда только на мобильном приложении на Android 5+ появлялся плейсхолдер заместо ориганального изображения. Тогда еще были проблемы с тем, чтобы это воспроизвести. Но все же, не забывайте о существовании такой ошибки!

#### DevTools для самых внимательных
*Демо!*
* Скрытие элемента по хоткею `H`, так же как и скролл по `S`
* Выделение измененных стилей в Firefox
* Переключение классов Chrome
* Редактор анимации
* *Посмотреть Safari и IE, ну и Opera тоже*
* Промисы и async в Chrome
